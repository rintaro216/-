# 🔐 おんぷタイム 管理画面ガイド

このドキュメントは、おんぷタイムの管理画面の使い方とセキュリティについて説明します。

---

## 📊 管理画面でできること

### 1. 予約管理
- 予約の確認・検索
- 予約のキャンセル
- 予約履歴の確認

### 2. スタジオ管理（Phase 3.2で実装予定）
- スタジオの一時休止設定
- スタジオ情報の編集

---

## 🔐 セキュリティについて

### ✅ 管理画面は保護されています

**3段階のセキュリティ：**

1. **URLは非公開**
   - 一般ユーザーには管理画面のリンクが表示されません
   - 直接URLを知っている人だけがアクセスできます

2. **ログインが必須**
   - 管理画面にアクセスするには、必ずログインが必要です
   - ログインせずにアクセスしようとすると、ログイン画面に転送されます

3. **Supabaseでアカウント管理**
   - 管理者アカウントは、Supabaseダッシュボードから**あなただけが**作成できます
   - 一般ユーザーは勝手にアカウントを作成できません

---

## 🛠️ 初回セットアップ

### ステップ1: Supabaseで管理者アカウントを作成

#### 1-1. Supabaseダッシュボードにアクセス

```
https://supabase.com/dashboard
```

にアクセスして、ログインします。

#### 1-2. プロジェクトを選択

あなたのおんぷタイムプロジェクトを選択します。

#### 1-3. 管理者アカウントを作成

1. 左サイドバーの **「Authentication」** をクリック
2. **「Users」** タブを選択
3. 右上の **「Add user」** ボタンをクリック
4. 以下の情報を入力：

   ```
   Email: admin@onpukan.com
   Password: （強力なパスワード）

   ✅ 推奨パスワード：
   - 12文字以上
   - 大文字・小文字・数字・記号を含む
   - 例: OnpuAdmin2025!@#
   ```

5. **「Create user」** をクリック

#### 1-4. メール確認（オプション）

Supabaseの設定で「Email confirmation」が有効な場合、登録したメールアドレスに確認メールが届きます。リンクをクリックしてアカウントを有効化してください。

---

### ステップ2: 管理画面にログイン

#### 2-1. 管理画面URLにアクセス

デプロイしたサイトの管理画面URLにアクセス：

```
https://your-site.vercel.app/admin/login
または
https://your-site.netlify.app/admin/login
```

#### 2-2. ログイン

作成したメールアドレスとパスワードを入力して「ログイン」ボタンをクリック。

#### 2-3. ダッシュボード表示

ログインに成功すると、管理ダッシュボードが表示されます。

---

## 📖 使い方

### 予約管理

#### 予約一覧の確認

1. ダッシュボードから **「予約管理」** をクリック
2. すべての予約が新しい順に表示されます

#### 予約の検索

画面上部のフィルターを使って、予約を絞り込めます：

- **テキスト検索**: 名前・電話番号・予約番号で検索
- **日付**: 特定の日付の予約のみ表示
- **エリア**: おんぷ館/みどり楽器で絞り込み
- **ステータス**: 予約確定/キャンセル済/利用完了で絞り込み

#### 予約のキャンセル

1. キャンセルしたい予約の右側にある **「キャンセル」** ボタンをクリック
2. 確認ダイアログで **「OK」** をクリック
3. 予約がキャンセルされ、ステータスが「キャンセル済」に変わります

#### 注意点

⚠️ **キャンセルは取り消せません**
- キャンセルした予約は元に戻せません
- キャンセル前に必ず確認してください

---

## 🔒 セキュリティのベストプラクティス

### パスワード管理

✅ **推奨：**
- パスワードは定期的に変更する（3ヶ月ごと）
- パスワードは紙に書いて安全な場所に保管、または1Passwordなどのパスワードマネージャーを使用
- 他のサービスと同じパスワードを使わない

❌ **非推奨：**
- 簡単なパスワード（例: `password123`, `admin`）
- パスワードを誰かと共有する
- パスワードをメモ帳やメールに保存する

### ログアウト

管理作業が終わったら、必ず **「ログアウト」** ボタンをクリックしてログアウトしてください。

### 複数の管理者

複数の管理者アカウントが必要な場合：

1. Supabase Dashboard → Authentication → Users
2. **「Add user」** で新しいアカウントを作成
3. 各管理者に個別のアカウントを割り当てる

**推奨：** 複数人で1つのアカウントを共有しない

---

## 🚨 トラブルシューティング

### ログインできない

**原因1: メールアドレスまたはパスワードが間違っている**
- 入力内容を確認してください
- パスワードは大文字・小文字を区別します

**原因2: アカウントがまだ作成されていない**
- Supabase Dashboardで管理者アカウントを作成してください

**原因3: メール確認が必要**
- Supabaseの設定で「Email confirmation」が有効な場合、メールの確認リンクをクリックしてください

### パスワードを忘れた

1. Supabase Dashboard にアクセス
2. Authentication → Users
3. 該当ユーザーを選択
4. **「Send password recovery email」** をクリック
5. メールのリンクからパスワードをリセット

### 予約が表示されない

**原因1: データベース接続エラー**
- ブラウザの開発者ツール（F12）でエラーを確認
- 環境変数（Supabase URL/Key）が正しく設定されているか確認

**原因2: フィルターがかかっている**
- 画面上部の **「フィルタをリセット」** ボタンをクリック

---

## 📞 サポート

問題が解決しない場合：

1. ブラウザの開発者ツール（F12キー）でエラーメッセージを確認
2. Supabaseダッシュボードでデータベースの状態を確認
3. 必要に応じて開発者に連絡

---

## 🔄 アカウント管理チェックリスト

定期的に以下を確認してください：

- [ ] パスワードは3ヶ月以内に変更しましたか？
- [ ] 不要な管理者アカウントは削除しましたか？
- [ ] ログアウトを忘れていませんか？
- [ ] パスワードは安全に保管していますか？

---

**作成日**: 2025-10-13
**最終更新**: 2025-10-13
**バージョン**: 1.0

© 2025 おんぷ館. All rights reserved.
